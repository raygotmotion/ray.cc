-- Services and Player Variables
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Configuration
local CamlockState = false
local Prediction = 0.13186387446
local XPrediction = 0.13186387446
local YPrediction = 0.13186387446
local Smoothness = 0.03 -- Adjust for smoother or faster camera movement
local Locked = false
getgenv().Key = "q" -- Hotkey for toggling lock

-- Asset IDs
local lockedImage = "rbxassetid://118105910981088"
local unlockedImage = "rbxassetid://79893468282955"

-- Create Tracking Dot
local function createTrackingDot()
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Size = UDim2.new(0, 20, 0, 20)
    billboardGui.StudsOffset = Vector3.new(0, 2, 0) -- Offset from the player's position
    billboardGui.AlwaysOnTop = true
    billboardGui.Enabled = false -- Initially hidden
    billboardGui.Parent = workspace.CurrentCamera -- Attach to the camera

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BackgroundColor3 = Color3.fromRGB(128, 0, 128) -- Purple color
    frame.BorderSizePixel = 0
    frame.BorderColor3 = Color3.fromRGB(128, 0, 128) -- Same color as background
    frame.BackgroundTransparency = 0.5 -- Semi-transparent
    frame.Parent = billboardGui

    -- Make the frame a circle
    local uICorner = Instance.new("UICorner")
    uICorner.CornerRadius = UDim.new(0.5, 0)
    uICorner.Parent = frame

    -- Add glow effect
    local uiStroke = Instance.new("UIStroke")
    uiStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    uiStroke.Color = Color3.fromRGB(128, 0, 128) -- Purple glow color
    uiStroke.Thickness = 2 -- Glow thickness
    uiStroke.Parent = frame

    return billboardGui, frame
end

-- Find Nearest Enemy
local function findNearestEnemy()
    local closestDistance, closestPlayer = math.huge, nil
    local centerPosition = Vector2.new(game:GetService("GuiService"):GetScreenResolution().X / 2,
                                       game:GetService("GuiService"):GetScreenResolution().Y / 2)

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                local torso = character:FindFirstChild("Torso") or character:FindFirstChild("UpperTorso")

                if humanoid and torso and humanoid.Health > 0 then
                    local position, isVisibleOnViewport = game:GetService("Workspace").CurrentCamera:WorldToViewportPoint(torso.Position)

                    if isVisibleOnViewport then
                        local distance = (centerPosition - Vector2.new(position.X, position.Y)).Magnitude
                        if distance < closestDistance then
                            closestPlayer = torso
                            closestDistance = distance
                        end
                    end
                end
            end
        end
    end

    return closestPlayer
end

-- Initialize
local enemy = nil
local trackingDot, trackingDotFrame = createTrackingDot()

-- Camera Locking Logic
RunService.Heartbeat:Connect(function()
    if CamlockState and enemy then
        local camera = workspace.CurrentCamera
        local targetPosition = enemy.Position + enemy.Velocity * Prediction
        targetPosition = Vector3.new(targetPosition.X + XPrediction, targetPosition.Y + YPrediction, targetPosition.Z)

        -- Interpolate between the current camera position and the target position
        local currentPosition = camera.CFrame.Position
        local newPosition = currentPosition:Lerp(targetPosition, Smoothness)
        camera.CFrame = CFrame.new(newPosition, targetPosition)

        -- Update tracking dot position
        trackingDot.Enabled = true
        trackingDot.Adornee = enemy
        local distance = (camera.CFrame.Position - enemy.Position).Magnitude
        local size = math.clamp(20 / (distance / 10), 5, 20) -- Adjust size range and scaling factor as needed
        trackingDotFrame.Size = UDim2.new(0, size, 0, size)
    else
        trackingDot.Enabled = false
    end
end)

-- Toggle Lock on Key Press
Mouse.KeyDown:Connect(function(k)
    if k == getgenv().Key then
        Locked = not Locked
        if Locked then
            enemy = findNearestEnemy()
            CamlockState = true
        else
            enemy = nil
            CamlockState = false
        end
    end
end)

-- GUI Creation
local BladLock = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local Logo = Instance.new("ImageLabel")
local TextButton = Instance.new("TextButton")
local UICorner_2 = Instance.new("UICorner")

-- Properties
BladLock.Name = "BlackGuy"
BladLock.Parent = game.CoreGui
BladLock.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

Frame.Parent = BladLock
Frame.BackgroundColor3 = Color3.fromRGB(255, 255, 255) -- White background
Frame.BackgroundTransparency = 0 -- No transparency
Frame.BorderSizePixel = 0
Frame.Position = UDim2.new(0.5, -85/2, 0.5, -70/2) -- Center the Frame
Frame.Size = UDim2.new(0, 85, 0, 70)
Frame.Active = true
Frame.Draggable = true

UICorner.Parent = Frame

Logo.Name = "Logo"
Logo.Parent = Frame
Logo.BackgroundTransparency = 1 -- Fully transparent background for the logo
Logo.BorderSizePixel = 0
Logo.Size = UDim2.new(1, 0, 1, 0) -- Stretch to fill the Frame
Logo.Position = UDim2.new(0, 0, 0, 0) -- Position at the top-left corner of the Frame
Logo.ImageTransparency = 1 -- Initially hide the logo
Logo.ImageColor3 = Color3.fromRGB(255, 255, 255) -- Ensure the image is white

TextButton.Parent = Frame
TextButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255) -- White background
TextButton.BackgroundTransparency = 1 -- Fully transparent background
TextButton.BorderColor3 = Color3.fromRGB(139, 0, 0)
TextButton.BorderSizePixel = 0
TextButton.Position = UDim2.new(0.5, -35, 0.5, -25) -- Center the TextButton
TextButton.Size = UDim2.new(0, 70, 0, 50)
TextButton.Font = Enum.Font.SourceSansSemibold
TextButton.Text = "ray lock"
TextButton.TextColor3 = Color3.fromRGB(139, 0, 0)
TextButton.TextScaled = true
TextButton.TextSize = 24
TextButton.TextWrapped = true
TextButton.TextStrokeTransparency = 0.8 -- Add some stroke for better visibility

local state = true
TextButton.MouseButton1Click:Connect(function()
    state = not state
    if state then
        TextButton.Text = "" -- Hide text when clicked
        CamlockState = true
        enemy = findNearestEnemy()
        Logo.Image = lockedImage -- Set to locked image
        Logo.ImageTransparency = 0 -- Show locked image
        trackingDot.Enabled = true -- Show tracking dot when locked
        game.StarterGui:SetCore("SendNotification", { Title = "ray.cc", Text = "Locked" })
    else
        TextButton.Text = "" -- Hide text when clicked
        CamlockState = false
        enemy = nil
        Logo.Image = unlockedImage -- Set to unlocked image
        Logo.ImageTransparency = 0 -- Show unlocked image
        trackingDot.Enabled = false -- Hide tracking dot when unlocked
        game.StarterGui:SetCore("SendNotification", { Title = "ray.cc", Text = "Unlocked" })
    end
end)

UICorner_2.Parent = TextButton
Frame.Active = true
Frame.Draggable = true
